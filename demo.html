<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Running Coach â€” Demo</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: var(--tg-theme-bg-color, #ffffff);
    --text: var(--tg-theme-text-color, #000000);
    --hint: var(--tg-theme-hint-color, #999999);
    --link: var(--tg-theme-link-color, #2678b6);
    --btn: var(--tg-theme-button-color, #2678b6);
    --btn-text: var(--tg-theme-button-text-color, #ffffff);
    --secondary-bg: var(--tg-theme-secondary-bg-color, #f0f0f0);
    --section-bg: var(--tg-theme-section-bg-color, var(--bg));
    --card-radius: 16px;
    --success: #22c55e;
    --core-color: #F59E0B;
    --method-color: #8B5CF6;
    --stretch-color: #EAB308;
    --nav-height: 56px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--secondary-bg);
    color: var(--text);
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
    padding-bottom: calc(var(--nav-height) + env(safe-area-inset-bottom) + 60px);
  }

  .container { max-width: 480px; margin: 0 auto; padding: 0 16px; }
  .tab-content { display: none; padding-top: 12px; padding-bottom: 16px; }
  .tab-content.active { display: block; animation: fadeIn 0.25s ease; }

  .ic { display: inline-flex; align-items: center; justify-content: center; vertical-align: middle; }
  .ic svg { width: 1em; height: 1em; stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

  /* Demo Banner */
  .demo-banner {
    position: sticky; top: 0; z-index: 100;
    background: linear-gradient(135deg, #7c3aed, #6d28d9);
    color: #fff; text-align: center;
    padding: 8px 16px; font-size: 12px; font-weight: 600;
    letter-spacing: 0.3px;
  }

  /* Bottom Navigation */
  .bottom-nav {
    position: fixed; bottom: 0; left: 0; right: 0; z-index: 50;
    background: var(--bg);
    border-top: 1px solid var(--secondary-bg);
    padding-bottom: env(safe-area-inset-bottom);
  }
  .bottom-nav-inner {
    max-width: 480px; margin: 0 auto;
    display: flex; align-items: center; justify-content: space-around;
  }
  .nav-btn {
    flex: 1; display: flex; flex-direction: column; align-items: center; gap: 2px;
    padding: 8px 0 6px; border: none; background: transparent; cursor: pointer;
    -webkit-tap-highlight-color: transparent; transition: color 0.15s; color: var(--hint);
  }
  .nav-btn.active { color: var(--btn); }
  .nav-btn svg { width: 22px; height: 22px; }
  .nav-btn.active svg { stroke-width: 2.5; }
  .nav-btn span { font-size: 10px; font-weight: 500; }
  .nav-btn.active span { font-weight: 700; }

  /* Close Button */
  .close-section { padding: 0 16px; max-width: 480px; margin: 8px auto 0; }
  .btn-close-chat {
    display: flex; align-items: center; justify-content: center; gap: 6px;
    width: 100%; padding: 12px; border: 1.5px solid var(--hint); border-radius: 12px;
    background: transparent; color: var(--text); font-size: 14px; font-weight: 600;
    cursor: pointer; -webkit-tap-highlight-color: transparent;
  }
  .btn-close-chat svg { width: 16px; height: 16px; }

  /* Card */
  .card { background: var(--bg); border-radius: var(--card-radius); padding: 16px; margin-bottom: 12px; }

  /* ===== HOME TAB ===== */
  .home-header-card { animation: fadeIn 0.4s ease; }
  .home-top { display: flex; align-items: center; gap: 14px; }
  .avatar { position: relative; flex-shrink: 0; }
  .avatar-circle {
    width: 60px; height: 60px; border-radius: 50%;
    background: var(--btn); color: var(--btn-text);
    display: flex; align-items: center; justify-content: center;
    font-size: 22px; font-weight: 700;
  }
  .avatar-badge {
    position: absolute; bottom: -2px; right: -2px;
    width: 22px; height: 22px; border-radius: 50%;
    background: var(--link); color: #fff;
    font-size: 10px; font-weight: 700;
    display: flex; align-items: center; justify-content: center;
    border: 2px solid var(--bg);
  }
  .home-info { flex: 1; min-width: 0; }
  .home-name { font-size: 18px; font-weight: 700; }
  .home-sub { font-size: 12px; color: var(--hint); margin-top: 2px; display: flex; align-items: center; gap: 4px; }
  .home-streak { display: inline-flex; align-items: center; gap: 3px; color: #ef4444; font-weight: 600; }
  .home-streak svg { width: 14px; height: 14px; stroke: #ef4444; }
  .home-xp-row { display: flex; align-items: center; gap: 8px; margin-top: 8px; }
  .home-xp-bar { flex: 1; height: 8px; background: var(--secondary-bg); border-radius: 4px; overflow: hidden; }
  .home-xp-fill { height: 100%; border-radius: 4px; background: linear-gradient(90deg, var(--btn), var(--link)); transition: width 0.8s ease; position: relative; overflow: hidden; }
  .home-xp-fill::after { content: ''; position: absolute; inset: 0; background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%); animation: shimmer 2s infinite; }
  .home-xp-label { font-size: 11px; font-weight: 600; color: var(--hint); white-space: nowrap; }
  .home-stats {
    display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; margin-top: 14px;
  }
  .hs-item { display: flex; flex-direction: column; align-items: center; padding: 8px 4px; background: var(--secondary-bg); border-radius: 10px; }
  .hs-value { font-size: 15px; font-weight: 700; }
  .hs-label { font-size: 10px; color: var(--hint); margin-top: 1px; }

  .section-title {
    font-size: 16px; font-weight: 700; margin: 16px 0 10px;
    display: flex; align-items: center; gap: 6px;
  }
  .section-title .ic svg { width: 18px; height: 18px; }
  .section-title .count { font-size: 12px; color: var(--hint); font-weight: 500; margin-left: auto; }

  .quest-list { display: flex; flex-direction: column; gap: 8px; }
  .quest-card { background: var(--bg); border-radius: 12px; padding: 12px 12px 12px 16px; position: relative; overflow: hidden; }
  .quest-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; }
  .quest-card[data-type="core"]::before { background: var(--core-color); }
  .quest-card[data-type="method"]::before { background: var(--method-color); }
  .quest-card[data-type="stretch"]::before { background: var(--stretch-color); }
  .quest-card.completed { background: rgba(34,197,94,0.06); }
  .quest-card.completed .quest-done-ic { position: absolute; right: 12px; top: 12px; color: var(--success); }
  .quest-card.completed .quest-done-ic svg { width: 20px; height: 20px; }
  .quest-top { display: flex; align-items: center; gap: 6px; margin-bottom: 4px; }
  .quest-pill { font-size: 10px; font-weight: 600; padding: 2px 7px; border-radius: 20px; color: #fff; }
  .quest-pill.core { background: var(--core-color); }
  .quest-pill.method { background: var(--method-color); }
  .quest-pill.stretch { background: var(--stretch-color); }
  .quest-xp { font-size: 10px; font-weight: 600; color: var(--link); margin-left: auto; }
  .quest-title { font-size: 14px; font-weight: 600; margin-bottom: 6px; }
  .quest-progress-bar { height: 6px; background: var(--secondary-bg); border-radius: 3px; overflow: hidden; }
  .quest-progress-fill { height: 100%; border-radius: 3px; transition: width 0.6s ease; }
  .quest-card[data-type="core"] .quest-progress-fill { background: var(--core-color); }
  .quest-card[data-type="method"] .quest-progress-fill { background: var(--method-color); }
  .quest-card[data-type="stretch"] .quest-progress-fill { background: var(--stretch-color); }
  .quest-card.completed .quest-progress-fill { background: var(--success); }
  .quest-progress-text { font-size: 11px; color: var(--hint); margin-top: 3px; text-align: right; }

  /* Home: Summary Cards */
  .summary-row { display: flex; gap: 8px; margin-bottom: 12px; }
  .summary-card { flex: 1; background: var(--bg); border-radius: 14px; padding: 14px; border: 1px solid var(--secondary-bg); }
  .summary-card-head { display: flex; align-items: center; gap: 6px; margin-bottom: 8px; }
  .summary-card-head .sc-icon { color: var(--btn); display: flex; }
  .summary-card-head .sc-icon svg { width: 16px; height: 16px; }
  .summary-card-head .sc-title { font-size: 12px; font-weight: 600; color: var(--hint); }
  .sc-content { font-size: 13px; line-height: 1.6; }
  .sc-content .sc-row { display: flex; align-items: center; gap: 4px; }
  .sc-content .sc-label { color: var(--hint); font-size: 11px; }
  .sc-content .sc-value { font-weight: 600; }
  .plan-mini { display: flex; gap: 3px; margin-top: 4px; }
  .plan-mini-day { flex: 1; text-align: center; padding: 4px 0; border-radius: 6px; font-size: 10px; }
  .plan-mini-day.rest { background: var(--secondary-bg); color: var(--hint); }
  .plan-mini-day.active { background: rgba(var(--btn-rgb,38,120,182),0.12); color: var(--btn); font-weight: 600; }
  .plan-mini-dist { font-size: 9px; font-weight: 700; }

  /* ===== QUEST PATH TAB ===== */
  .quest-path-title { font-size: 20px; font-weight: 700; margin-bottom: 4px; }
  .quest-path-sub { font-size: 13px; color: var(--hint); margin-bottom: 20px; }
  .path-container { position: relative; }
  .path-line { position: absolute; left: 20px; top: 0; bottom: 0; width: 2px; background: var(--secondary-bg); }
  .path-stages { display: flex; flex-direction: column; gap: 10px; }
  .stage-item { position: relative; }
  .stage-node {
    position: absolute; left: 20px; top: 16px; transform: translateX(-50%); z-index: 2;
    width: 32px; height: 32px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    border: 3px solid var(--secondary-bg); background: var(--bg); color: var(--hint);
  }
  .stage-node svg { width: 14px; height: 14px; }
  .stage-item.completed .stage-node { border-color: var(--btn); background: var(--btn); color: var(--btn-text); }
  .stage-item.current .stage-node { border-color: var(--btn); color: var(--btn); animation: pulse 2s infinite; }
  .stage-card {
    margin-left: 48px; border-radius: 14px; padding: 14px;
    border: 1px solid var(--secondary-bg); background: var(--bg);
    cursor: pointer; -webkit-tap-highlight-color: transparent; transition: all 0.2s;
  }
  .stage-item.completed .stage-card { border-color: rgba(var(--btn-rgb, 38,120,182), 0.15); background: rgba(var(--btn-rgb, 38,120,182), 0.03); }
  .stage-item.current .stage-card { border-color: var(--btn); box-shadow: 0 2px 12px rgba(var(--btn-rgb, 38,120,182), 0.1); }
  .stage-item.locked .stage-card { opacity: 0.5; cursor: default; }
  .stage-head { display: flex; align-items: center; justify-content: space-between; }
  .stage-meta { display: flex; align-items: center; gap: 6px; }
  .stage-lv { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--hint); }
  .stage-item.completed .stage-lv, .stage-item.current .stage-lv { color: var(--btn); }
  .stage-now-badge { font-size: 9px; font-weight: 700; padding: 1px 6px; border-radius: 10px; background: var(--btn); color: var(--btn-text); }
  .stage-count { font-size: 12px; color: var(--hint); }
  .stage-chevron { color: var(--hint); transition: transform 0.2s; display: flex; }
  .stage-chevron svg { width: 16px; height: 16px; }
  .stage-chevron.open { transform: rotate(180deg); }
  .stage-title { font-size: 15px; font-weight: 700; margin-top: 4px; }
  .stage-item.locked .stage-title { color: var(--hint); }
  .stage-desc { font-size: 12px; color: var(--hint); margin-top: 2px; }
  .stage-progress-bar { margin-top: 10px; height: 4px; background: var(--secondary-bg); border-radius: 2px; overflow: hidden; }
  .stage-progress-fill { height: 100%; border-radius: 2px; background: var(--btn); transition: width 0.6s ease; }
  .stage-missions { margin-top: 8px; padding: 10px; background: var(--secondary-bg); border-radius: 10px; display: flex; flex-direction: column; gap: 6px; }
  .mission-row { display: flex; align-items: center; gap: 8px; padding: 4px; }
  .mission-check { width: 18px; height: 18px; border-radius: 50%; flex-shrink: 0; display: flex; align-items: center; justify-content: center; }
  .mission-check svg { width: 12px; height: 12px; }
  .mission-check.done { background: var(--btn); color: var(--btn-text); }
  .mission-check.pending { border: 2px solid var(--hint); opacity: 0.4; }
  .mission-name { font-size: 13px; }
  .mission-row.done .mission-name { font-weight: 500; }
  .mission-row.pending .mission-name { color: var(--hint); }
  .trophy-final { position: relative; margin-top: 10px; }
  .trophy-node {
    position: absolute; left: 20px; top: 10px; transform: translateX(-50%); z-index: 2;
    width: 36px; height: 36px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    background: var(--secondary-bg); color: var(--btn);
  }
  .trophy-node svg { width: 18px; height: 18px; }
  .trophy-card { margin-left: 48px; border-radius: 14px; padding: 14px; border: 1px solid var(--secondary-bg); background: var(--bg); }
  .trophy-title { font-size: 15px; font-weight: 700; }
  .trophy-desc { font-size: 12px; color: var(--hint); margin-top: 2px; }

  /* ===== PLAN TAB ===== */
  .plan-page-title { font-size: 20px; font-weight: 700; margin-bottom: 4px; }
  .plan-page-sub { font-size: 13px; color: var(--hint); margin-bottom: 16px; }
  .plan-summary {
    display: flex; gap: 8px; margin-bottom: 16px;
  }
  .plan-stat {
    flex: 1; background: var(--bg); border-radius: 12px; padding: 12px; text-align: center;
    border: 1px solid var(--secondary-bg);
  }
  .plan-stat-value { font-size: 20px; font-weight: 700; }
  .plan-stat-label { font-size: 10px; color: var(--hint); margin-top: 2px; }
  .plan-days { display: flex; flex-direction: column; gap: 8px; }
  .plan-day-card {
    background: var(--bg); border-radius: 14px; padding: 14px;
    border: 1px solid var(--secondary-bg); display: flex; align-items: center; gap: 12px;
  }
  .plan-day-card.rest { opacity: 0.6; }
  .plan-day-badge {
    width: 40px; height: 40px; border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 14px; font-weight: 700; flex-shrink: 0;
  }
  .plan-day-badge.run { background: rgba(var(--btn-rgb,38,120,182),0.12); color: var(--btn); }
  .plan-day-badge.rest { background: var(--secondary-bg); color: var(--hint); }
  .plan-day-info { flex: 1; }
  .plan-day-title { font-size: 14px; font-weight: 600; }
  .plan-day-detail { font-size: 12px; color: var(--hint); margin-top: 2px; }
  .plan-day-km { font-size: 15px; font-weight: 700; color: var(--btn); text-align: right; white-space: nowrap; }

  @keyframes shimmer { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
</style>
</head>
<body>

<div class="demo-banner">ğŸ­ ë°ëª¨ ëª¨ë“œ â€” ì‹¤ì œ ë°ì´í„°ê°€ ì•„ë‹™ë‹ˆë‹¤</div>

<div class="container" id="app"></div>

<div class="close-section">
  <button class="btn-close-chat" id="btn-close">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
    ì±„íŒ…ìœ¼ë¡œ ëŒì•„ê°€ê¸°
  </button>
</div>

<nav class="bottom-nav">
  <div class="bottom-nav-inner">
    <button class="nav-btn active" data-tab="home">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      <span>í™ˆ</span>
    </button>
    <button class="nav-btn" data-tab="quest">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" y1="3" x2="9" y2="18"/><line x1="15" y1="6" x2="15" y2="21"/></svg>
      <span>í€˜ìŠ¤íŠ¸</span>
    </button>
    <button class="nav-btn" data-tab="plan">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
      <span>ê³„íš</span>
    </button>
  </div>
</nav>

<script>
(function() {
  // ---- SVG Icons ----
  var I = {
    flame: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0011 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 11-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 002.5 2.5z"/></svg>',
    check: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>',
    checkCircle: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>',
    zap: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>',
    lock: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>',
    trophy: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 010-5H6"/><path d="M18 9h1.5a2.5 2.5 0 000-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20 17 22"/><path d="M18 2H6v7a6 6 0 1012 0V2z"/></svg>',
    swords: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="14.5 17.5 3 6 3 3 6 3 17.5 14.5"/><line x1="13" y1="19" x2="19" y2="13"/><line x1="16" y1="16" x2="20" y2="20"/><line x1="19" y1="21" x2="21" y2="19"/><polyline points="14.5 6.5 18 3 21 3 21 6 17.5 9.5"/><line x1="5" y1="14" x2="9" y2="18"/><line x1="7" y1="17" x2="4" y2="20"/><line x1="3" y1="19" x2="5" y2="21"/></svg>',
    chevronDown: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>',
    user: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>',
    clipboard: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg>',
  };
  function icon(name) { return I[name] || ''; }
  function esc(s) { var d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

  // ---- Demo Data ----
  var DEMO = {
    name: 'ë°ëª¨ ëŸ¬ë„ˆ',
    level: 4,
    title: 'ê¾¸ì¤€í•œ ëŸ¬ë„ˆ',
    xp: 780,
    next_xp: 1150,
    streak: 6,
    total_runs: 47,
    total_km: 312,
    total_xp: 780,
    weekly_plan: [
      { day: 'ì›”', title: 'ì´ì§€ëŸ°', km: 6, zone: 'Z1-Z2', rest: false },
      { day: 'í™”', title: 'ì¸í„°ë²Œ', km: 8, zone: 'Z4', rest: false },
      { day: 'ìˆ˜', title: 'íœ´ì‹', km: 0, zone: '', rest: true },
      { day: 'ëª©', title: 'í…œí¬ëŸ°', km: 7, zone: 'Z3-Z4', rest: false },
      { day: 'ê¸ˆ', title: 'ì´ì§€ëŸ°', km: 5, zone: 'Z1-Z2', rest: false },
      { day: 'í† ', title: 'ë¡±ëŸ°', km: 14, zone: 'Z2', rest: false },
      { day: 'ì¼', title: 'íœ´ì‹', km: 0, zone: '', rest: true },
    ],
    quests: [
      { type: 'core', title: 'ì£¼ê°„ ëŸ¬ë‹ 5íšŒ ì™„ë£Œ', current: 5, target: 5, unit: 'íšŒ', completed: true },
      { type: 'method', title: 'Z1-Z2 ë¹„ìœ¨ 80%+', current: 72, target: 80, unit: '%', completed: false },
      { type: 'stretch', title: 'ì£¼ê°„ 35.2km ë‹¬ì„±', current: 28.5, target: 35.2, unit: 'km', completed: false },
    ],
    quest_path: [
      { level: 1, title: 'ì²« ë°œìêµ­', status: 'completed', missions: [
        { name: 'ì²« ëŸ¬ë‹ ì™„ë£Œ', done: true }, { name: '3ì¼ ì—°ì† ì•± ì‚¬ìš©', done: true }
      ]},
      { level: 2, title: 'ë¦¬ë“¬ì„ ì°¾ëŠ” ëŸ¬ë„ˆ', status: 'completed', missions: [
        { name: 'ì£¼ 3íšŒ ëŸ¬ë‹ ë‹¬ì„±', done: true }, { name: '5km ì™„ì£¼', done: true }
      ]},
      { level: 3, title: 'ì›Œë°ì—… ëŸ¬ë„ˆ', status: 'completed', missions: [
        { name: '10km ì™„ì£¼', done: true }, { name: '4ì£¼ ì—°ì† ëŸ¬ë‹', done: true }
      ]},
      { level: 4, title: 'ê¾¸ì¤€í•œ ëŸ¬ë„ˆ', status: 'current', missions: [
        { name: 'ì£¼ê°„ 30km ë‹¬ì„±', done: true }, { name: '8ì£¼ ì—°ì† ëŸ¬ë‹', done: false }, { name: 'ì²´ë ¥ì§€ìˆ˜ 20 ë„ë‹¬', done: false }
      ]},
      { level: 5, title: 'ë„ì „í•˜ëŠ” ëŸ¬ë„ˆ', status: 'locked', missions: [
        { name: 'í•˜í”„ë§ˆë¼í†¤ ì™„ì£¼', done: false }, { name: 'ì£¼ê°„ 40km ë‹¬ì„±', done: false }
      ]},
    ],
    survey: { goal: '10km ëŒ€íšŒ ì™„ì£¼', freq: 'ì£¼ 3~4íšŒ', priority: 'ê±°ë¦¬ ëŠ˜ë¦¬ê¸°' },
  };

  var QUEST_XP = { core: 30, method: 40, stretch: 50 };
  var QUEST_TYPE_LABELS = { core: 'í•µì‹¬', method: 'í›ˆë ¨ë²•', stretch: 'ë„ì „' };

  var tg = window.Telegram && window.Telegram.WebApp;
  if (tg) { tg.ready(); tg.expand(); }

  var params = new URLSearchParams(window.location.search);
  var activeTab = params.get('view') || 'home';
  if (['home','quest','plan'].indexOf(activeTab) === -1) activeTab = 'home';
  var expandedStage = null;

  // ---- HOME VIEW ----
  function renderHome() {
    var xpPct = Math.min(100, (DEMO.xp / DEMO.next_xp) * 100);
    var html = '<div class="card home-header-card"><div class="home-top">' +
      '<div class="avatar"><div class="avatar-circle">D</div><div class="avatar-badge">4</div></div>' +
      '<div class="home-info"><div class="home-name">' + esc(DEMO.name) + '</div>' +
      '<div class="home-sub">Lv.4 ' + esc(DEMO.title) +
      ' <span class="home-streak">' + icon('flame') + ' ' + DEMO.streak + 'ì£¼</span></div>' +
      '<div class="home-xp-row"><div class="home-xp-bar"><div class="home-xp-fill" style="width:' + xpPct + '%"></div></div><span class="home-xp-label">' + DEMO.xp + '/' + DEMO.next_xp + '</span></div>' +
      '</div></div>' +
      '<div class="home-stats">' +
        '<div class="hs-item"><div class="hs-value">' + DEMO.total_runs + '</div><div class="hs-label">ëŸ¬ë‹</div></div>' +
        '<div class="hs-item"><div class="hs-value">' + DEMO.total_km + '</div><div class="hs-label">km</div></div>' +
        '<div class="hs-item"><div class="hs-value">' + DEMO.streak + '</div><div class="hs-label">ì—°ì†(ì£¼)</div></div>' +
        '<div class="hs-item"><div class="hs-value">' + DEMO.total_xp + '</div><div class="hs-label">XP</div></div>' +
      '</div></div>';

    // Summary cards
    html += '<div class="summary-row">';
    html += '<div class="summary-card"><div class="summary-card-head"><span class="sc-icon">' + icon('user') + '</span><span class="sc-title">ëŸ¬ë‹ í”„ë¡œí•„</span></div>' +
      '<div class="sc-content"><div class="sc-row"><span class="sc-value">' + esc(DEMO.survey.goal) + '</span></div>' +
      '<div class="sc-row"><span class="sc-label">' + esc(DEMO.survey.freq) + ' Â· ' + esc(DEMO.survey.priority) + '</span></div></div></div>';
    html += '<div class="summary-card"><div class="summary-card-head"><span class="sc-icon">' + icon('clipboard') + '</span><span class="sc-title">ì´ë²ˆ ì£¼ ê³„íš</span></div>' +
      '<div class="sc-content"><div class="sc-row"><span class="sc-value">5íšŒ</span><span class="sc-label"> Â· </span><span class="sc-value">40km</span></div></div>' +
      '<div class="plan-mini">';
    DEMO.weekly_plan.forEach(function(d) {
      var cls = d.rest ? 'rest' : 'active';
      html += '<div class="plan-mini-day ' + cls + '">' + d.day + (!d.rest ? '<div class="plan-mini-dist">' + d.km + '</div>' : '') + '</div>';
    });
    html += '</div></div></div>';

    // Quests
    var completed = DEMO.quests.filter(function(q) { return q.completed; }).length;
    html += '<div class="section-title"><span class="ic">' + icon('swords') + '</span> ì´ë²ˆ ì£¼ í€˜ìŠ¤íŠ¸ <span class="count">' + completed + '/' + DEMO.quests.length + '</span></div>';
    html += '<div class="quest-list">';
    DEMO.quests.forEach(function(q) {
      var pct = q.target > 0 ? Math.min(100, (q.current / q.target) * 100) : 0;
      var cls = q.completed ? ' completed' : '';
      html += '<div class="quest-card' + cls + '" data-type="' + q.type + '">';
      if (q.completed) html += '<div class="quest-done-ic">' + icon('checkCircle') + '</div>';
      html += '<div class="quest-top"><span class="quest-pill ' + q.type + '">' + esc(QUEST_TYPE_LABELS[q.type]) + '</span><span class="quest-xp">+' + QUEST_XP[q.type] + ' XP</span></div>' +
        '<div class="quest-title">' + esc(q.title) + '</div>' +
        '<div class="quest-progress-bar"><div class="quest-progress-fill" style="width:' + pct + '%"></div></div>' +
        '<div class="quest-progress-text">' + q.current + ' / ' + q.target + ' ' + esc(q.unit) + '</div></div>';
    });
    html += '</div>';
    return html;
  }

  // ---- QUEST PATH VIEW ----
  function renderQuestPath() {
    var stages = DEMO.quest_path;
    if (!expandedStage) { var cur = stages.find(function(s) { return s.status === 'current'; }); if (cur) expandedStage = cur.level; }

    var html = '<div class="quest-path-title">í€˜ìŠ¤íŠ¸ ê²½ë¡œ</div><div class="quest-path-sub">ë‹¨ê³„ë³„ ë¯¸ì…˜ì„ í´ë¦¬ì–´í•˜ë©° ì„±ì¥í•˜ì„¸ìš”</div>';
    html += '<div class="path-container"><div class="path-line"></div><div class="path-stages">';

    stages.forEach(function(stage) {
      var cm = stage.missions.filter(function(m) { return m.done; }).length;
      var tm = stage.missions.length;
      var isExp = expandedStage === stage.level;
      var nodeHtml = stage.status === 'completed' ? icon('check') : stage.status === 'current' ? icon('zap') : icon('lock');

      html += '<div class="stage-item ' + stage.status + '"><div class="stage-node">' + nodeHtml + '</div>' +
        '<div class="stage-card" data-stage-level="' + stage.level + '"><div class="stage-head"><div class="stage-meta"><span class="stage-lv">Lv.' + stage.level + '</span>';
      if (stage.status === 'current') html += '<span class="stage-now-badge">NOW</span>';
      html += '</div><div style="display:flex;align-items:center;gap:6px">';
      if (stage.status !== 'locked') html += '<span class="stage-count">' + cm + '/' + tm + '</span><span class="stage-chevron' + (isExp ? ' open' : '') + '">' + icon('chevronDown') + '</span>';
      html += '</div></div><div class="stage-title">' + esc(stage.title) + '</div>';

      if (stage.status === 'current') { var pct = tm > 0 ? (cm/tm)*100 : 0; html += '<div class="stage-progress-bar"><div class="stage-progress-fill" style="width:' + pct + '%"></div></div>'; }

      if (isExp && stage.status !== 'locked') {
        html += '<div class="stage-missions">';
        stage.missions.forEach(function(m) {
          var cls = m.done ? 'done' : 'pending';
          html += '<div class="mission-row ' + cls + '"><div class="mission-check ' + cls + '">' + (m.done ? icon('check') : '') + '</div><span class="mission-name">' + esc(m.name) + '</span></div>';
        });
        html += '</div>';
      }
      html += '</div></div>';
    });

    html += '<div class="trophy-final"><div class="trophy-node">' + icon('trophy') + '</div><div class="trophy-card"><div class="trophy-title">ìµœì¢… ëª©í‘œ</div><div class="trophy-desc">ëª¨ë“  í€˜ìŠ¤íŠ¸ë¥¼ í´ë¦¬ì–´í•˜ê³  ëŸ¬ë‹ ë§ˆìŠ¤í„°ê°€ ë˜ì„¸ìš”!</div></div></div>';
    html += '</div></div>';
    return html;
  }

  // ---- PLAN VIEW ----
  function renderPlan() {
    var plan = DEMO.weekly_plan;
    var totalKm = plan.reduce(function(a,d) { return a + d.km; }, 0);
    var totalRuns = plan.filter(function(d) { return !d.rest; }).length;

    var html = '<div class="plan-page-title">ì£¼ê°„ í›ˆë ¨ ê³„íš</div><div class="plan-page-sub">ì´ë²ˆ ì£¼ í›ˆë ¨ ìŠ¤ì¼€ì¤„ì„ í™•ì¸í•˜ì„¸ìš”</div>';

    html += '<div class="plan-summary">' +
      '<div class="plan-stat"><div class="plan-stat-value">' + totalRuns + 'íšŒ</div><div class="plan-stat-label">í›ˆë ¨ íšŸìˆ˜</div></div>' +
      '<div class="plan-stat"><div class="plan-stat-value">' + totalKm + 'km</div><div class="plan-stat-label">ì´ ê±°ë¦¬</div></div>' +
      '<div class="plan-stat"><div class="plan-stat-value">60/20/20</div><div class="plan-stat-label">ì´ì§€/í…œí¬/ì¸í„°ë²Œ</div></div>' +
    '</div>';

    html += '<div class="plan-days">';
    plan.forEach(function(d) {
      var cls = d.rest ? ' rest' : '';
      var badgeCls = d.rest ? 'rest' : 'run';
      html += '<div class="plan-day-card' + cls + '">' +
        '<div class="plan-day-badge ' + badgeCls + '">' + esc(d.day) + '</div>' +
        '<div class="plan-day-info"><div class="plan-day-title">' + esc(d.title) + '</div>';
      if (!d.rest) html += '<div class="plan-day-detail">' + esc(d.zone) + '</div>';
      html += '</div>';
      if (!d.rest) html += '<div class="plan-day-km">' + d.km + 'km</div>';
      html += '</div>';
    });
    html += '</div>';
    return html;
  }

  // ---- Render ----
  function renderActiveTab() {
    var app = document.getElementById('app');
    var html = '';
    if (activeTab === 'home') html = renderHome();
    else if (activeTab === 'quest') html = renderQuestPath();
    else if (activeTab === 'plan') html = renderPlan();
    app.innerHTML = '<div class="tab-content active">' + html + '</div>';
    attachEvents();
  }

  function switchTab(tab) {
    activeTab = tab;
    renderActiveTab();
    document.querySelectorAll('.nav-btn').forEach(function(b) { b.classList.toggle('active', b.dataset.tab === tab); });
    var url = new URL(window.location); url.searchParams.set('view', tab); history.replaceState(null, '', url);
    window.scrollTo(0, 0);
  }

  function attachEvents() {
    document.querySelectorAll('.stage-card').forEach(function(c) {
      c.addEventListener('click', function() {
        var lv = parseInt(this.dataset.stageLevel);
        var st = DEMO.quest_path.find(function(s) { return s.level === lv; });
        if (st && st.status === 'locked') return;
        expandedStage = expandedStage === lv ? null : lv;
        renderActiveTab();
      });
    });
  }

  // Init
  renderActiveTab();
  document.querySelectorAll('.nav-btn').forEach(function(b) {
    b.addEventListener('click', function() { switchTab(this.dataset.tab); });
    b.classList.toggle('active', b.dataset.tab === activeTab);
  });
  document.getElementById('btn-close').addEventListener('click', function() {
    if (tg) tg.close(); else window.close();
  });
})();
</script>
</body>
</html>
